<!DOCTYPE html>
<html>
<head>
    <title>Transformer Self-Attention 可视化</title>
    <style>
        .token { display: inline-block; padding: 10px; margin: 5px; border: 1px solid #ccc; }
        .matrix { display: inline-block; margin: 20px; }
        .attention-map { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .cell { padding: 10px; border: 1px solid #ddd; text-align: center; }
        .highlight { background-color: yellow; transition: background-color 0.3s; }
    </style>
</head>
<body>
    <h1>Self-Attention 机制可视化</h1>
    
    <div id="input-section">
        <h2>输入序列</h2>
        <div id="tokens">
            <div class="token" data-id="0">The</div>
            <div class="token" data-id="1">cat</div>
            <div class="token" data-id="2">sat</div>
            <div class="token" data-id="3">down</div>
        </div>
    </div>
    
    <div id="controls">
        <button id="step1">1. 生成Q/K/V</button>
        <button id="step2">2. 计算注意力分数</button>
        <button id="step3">3. 应用Softmax</button>
        <button id="step4">4. 加权求和</button>
        <button id="reset">重置</button>
    </div>
    
    <div id="visualization">
        <div id="qkv-matrices" class="matrix-container"></div>
        <div id="attention-scores" class="matrix-container"></div>
        <div id="attention-weights" class="matrix-container"></div>
        <div id="output" class="matrix-container"></div>
    </div>
    
    <script>
        // 这里将实现动画逻辑
        document.getElementById('step1').addEventListener('click', function() {
            // 生成并显示Q/K/V矩阵
            highlightStep(1);
            showQKVMatrices();
        });
        
        // 其他步骤的事件处理...
        
        function highlightStep(stepNum) {
            // 高亮显示当前步骤
        }
        
        function showQKVMatrices() {
            // 显示Q/K/V矩阵的动画
            const tokens = ['The', 'cat', 'sat', 'down'];
            const dim = 4; // 简化的维度
            
            // 生成随机Q/K/V矩阵 (实际中是通过学习得到的)
            const Q = tokens.map(t => Array(dim).fill(0).map(() => Math.random().toFixed(2)));
            const K = tokens.map(t => Array(dim).fill(0).map(() => Math.random().toFixed(2)));
            const V = tokens.map(t => Array(dim).fill(0).map(() => Math.random().toFixed(2)));
            
            // 渲染矩阵到DOM
            renderMatrix('Q', Q);
            renderMatrix('K', K);
            renderMatrix('V', V);
        }
        
        function renderMatrix(name, matrix) {
            // 渲染矩阵的HTML表示
        }
        
        // 其他辅助函数...
    </script>
</body>
</html>